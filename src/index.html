<!DOCTYPE html>
<html lang="en"  > <!--manifest="resolutionclient.appcache"-->
<head>
		<meta charset="utf-8">
		<title>Resolution Health | home</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">

		<link rel="stylesheet" href="css/rhstyle.css">

		<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
		<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
		<script src="socket.io.js"></script>
		<script type="text/javascript" src="js/moment.js"></script>
		<script type="text/javascript" src="js/Chart.js"></script>
		<script type="text/javascript" src="js/chartjs-plugin-streaming.js"></script>
		<script type="text/javascript" src="js/axios.js"></script>

		<script type="text/javascript" src="js/glMatrix-0.9.5.min.js"></script>
		<script type="text/javascript" src="js/webgl-utils.js"></script>
		<!-- Insert this line after script imports -->
		<script>if (window.module) module = window.module;</script>

</head>

<body onload="webGLStart();">
	<header>
			<img id="quoteslogo" src="images/quotes.png"> Resolution Health
			<div id="sensors">
				<a href="" id="sensor-list">Data & Sensors</a>
			</div>
			<div id="dmap">
				<a href="#" id="science-list">Science</a>
			</div>
			<div id="ptop">
				<a href="" id="ptop-list">PtoP</a>
			</div>
			<div id="identity">
				<a href="" id="authorisation-in" data-live-account="off" >Create account</a>
			</div>
		</header>

		<section id="life-health-menu">
			<nav id="select-gaiasoul-view">
				<ul>
					<li><a href="" id="kid-heart-view" class="notlivecontext" data-mappingview="on" >Heart</a></li>
					<li><a href="" id="kid-simulation-view" class="notlivecontext" data-mappingview="on" >Simulation</a></li>
					<li><a href="" id="kid-ourworld-view" class="notlivecontext" data-mappingview="off" >Our World</a></li>
					<li><a href="" id="kid-stream-view" class="livecontext" data-mappingview="off" >Stream</a></li>
					<li><a href="" id="kid-mindmap-view" class="notlivecontext" data-mappingview="off" >Knowledge Map</a></li>
				</ul>
			</nav>
		</section>

	<section id="authorisation">
		<form id="siginform" action="#" method="post">
			<div><Create private key for healthscience.network
			</div>
			<div><label for="password">Password</label>
				<input type="password" size="16" title="password" value="" class="text ui-widget-content ui-corner-all" id="password">
			</div>
			<button id="create-new-key" class="submit" type="submit">Create a new account</button>
		</form>
	</section>

	<section id="signed-in">
		<section id="live-status" >
			<div id="dhtkad-api">
				<a id="connectDHT" href="">Connected to healthscience.network </a> <!--<a id="seedDHT" href="" >SEED network</a>-->
			</div>
			<div id="governance-api">
				<a id="governance-api" href=""> GOVERNANCE</a> <!--<a id="seedDHT" href="" >SEED network</a>-->
			</div>
			<div class="clear"></div>
		</section>

		<section id="connectivity">
			<header class="onlinemode">
				<nav id="dapp-api-status">
					<ul>
						<li>
							 <img id="image-dshare" src="images/dshare-small.png" /> Decentralized Connectivity
							 <!--<a href="" id="sshare" data-sshare-status="on" ><img id="image-sshare" src="images/sshare-small.png" /></a>
							 <a href="" id="help-online" >HELP</a>-->
						</li>
					</ul>
				</nav>
			</header>
			<div id="science-api">
				<header>SCIENCE & COMPUTATION</header>
				<div class="D-apis" >LKN<div id="Dsensor-api-status">add</div></div>
				<div class="D-apis" >ethereum <div id="ethereum-api-status">add</div></div>
				<div class="D-apis" >Trubit <div id="truebit-api-status">add</div></div>
				<div class="D-apis" >Webassembly <div id="webassembly-api-status">add</div></div>
			</div>
			<div id="storage-api">
				<header>STORAGE</header>
				<div class="D-apis" >MaidSafe <div id="maidsafe-api-status">add</div></div>
				<div class="D-apis" >BigchainDB <div id="bigchain-api-status">add</div></div>
				<div class="D-apis" >IPFS <div id="ipfs-api-status">add</div></div>
				<div class="D-apis" >DAT <div id="dat-api-status">add</div></div>
				<div class="D-apis" >Swarm <div id="swarm-api-status">add</div></div>

			</div>
			<div id="money-api">
				<header>Currency</header>
				<div class="D-apis" >K-beacons<div id="quotes-api-status">add</div></div>
				<div class="D-apis" >safecoin <div id="safecoin-api-status">add</div></div>
			</div>
		</section>

		<section id="healthscience-governance">
				<header>GOVERNANCE</header>
				<div id="hs-peer-terms" class="hs-gov">
					<header>Terms of Participation</header>
					<div id="hs-terms-detail">
						<li>The healthscience.network is a TEST protocol.  While in test status we can not provide any reassurances about the privacy or securty of data.
						</li>
						<li>Each peer owns their own data.</li>
						<li>
							The healthsicnece.network provides a protocol to allow computation to learning and share scientific health knowledge that is open and free for anyone to use.
						</li>
					</div>
				</div>
				<div id="hs-peer-help" class="hs-gov">
					<header>Help & Support</header>
					The best help is given by a fellow peer on the network.  Online self help or ask forum.</div>
				<div id="hs-governance" class="hs-gov">
					<header>Network COOP Governance</header>
					</div>
				<div id="hs-voting" class="hs-gov">
					<header>Voting</header>
					</div>
				<div id="hs-technical" class="hs-gov">
					<header>Technical Contriubtion/Proposals</header>
					</div>
		</section>
	</section>

<!--science view -->
	<section id="science-view">
		<form id="science-form" action="#" method="post">
			<div>Contribute a problem, law, theory or computanal model
			</div>
			<div><label for="science-in">science-in</label>
				<input type="text" size="16" title="science-start-in" value="" class="text ui-widget-content ui-corner-all" id="science-contribute-start">
			</div>
			<button id="contribute-new-science" class="submit" type="submit">Gift Science</button>
		</form>
	</section> <!-- closes science tab -->

	<section id="ptop-view">
		<div id="Network Status">
			Network Status: connect to __ peers.
		</div>
	</section>
	<!-- devices, sensors, data -->
	<section id="sensor-data">
		List of devices and data stores
	</section>

<!-- charting wearable data -->
<section id="wearable-chart" >
	wearable charting
	<canvas id="canvas"></canvas>
		<div id="chart-controls"></div>
	<canvas id="canvas2"></canvas>
	<canvas id="canvas3"></canvas>
	</div>
	<br>
	<br>

</section>

<!-- Simulation of human heart -->
<section id="simulation-heart" >
<!---webgl base heart -->
	<canvas id="lesson11-canvas" style="border: grey solid 1px;" width="500" height="500" ></canvas>
	<br/>
	<input type="checkbox" id="lighting" checked /> Use lighting<br/>
	    Spin the moon by dragging it with the mouse.
	    <br/>

	    <h2>Directional light:</h2>

	    <table style="border: 0; padding: 10px;">
	        <tr>
	            <td><b>Direction:</b>
	            <td>X: <input type="text" id="lightDirectionX" value="-1.0" />
	            <td>Y: <input type="text" id="lightDirectionY" value="-1.0" />
	            <td>Z: <input type="text" id="lightDirectionZ" value="-1.0" />
	        </tr>
	        <tr>
	            <td><b>Colour:</b>
	            <td>R: <input type="text" id="directionalR" value="0.8" />
	            <td>G: <input type="text" id="directionalG" value="0.8" />
	            <td>B: <input type="text" id="directionalB" value="0.8" />
	        </tr>
	    </table>


	    <h2>Ambient light:</h2>

	    <table style="border: 0; padding: 10px;">
	        <tr>
	            <td><b>Colour:</b>
	            <td>R: <input type="text" id="ambientR" value="0.2" />
	            <td>G: <input type="text" id="ambientG" value="0.2" />
	            <td>B: <input type="text" id="ambientB" value="0.2" />
	        </tr>
	    </table>
	    <br/>

	<!--billy codethecity graphics-->
	<div id="app">
		<div class="wrapper">
	    <div class="heart">
	        <h3>Volume</h3>
	        <p><div id="heartvolume"></div> millilitres</p>
	        <h3>BPM</h3>
	        <p><div id="heartbpm"></div> beats per minute</p>
	        <h3>Amplitude</h3>
	        <p><div id="heartamplitude" ></div> % </p>
	    </div>
	    <div class="predicted">
	        <h3>Volume</h3>
	        <p><div id="predictheartvolume"></div> millilitres</p>
	        <h3>BPM</h3>
	        <p><div id="predictedbpm"></div> beats per minute</p>
	        <h3>Amplitude</h3>
	        <p><div id="predictedamplitude"></div> % </p>
	    </div>
	</div>
	<div class="hearts">
			<img src="images/heart.png" alt="Heart" id="heart" :style="{animationDuration: milliseconds(alg.F * 60)/2 + 'ms'}">
			<img src="images/heart.png" alt="Heart" id="predicted" :style="{animationDuration: milliseconds(alg2.F * 60)/2 + 'ms'}">
	</div>
 </div>
</section>

	<script type="text/javascript" src="start.js"></script>
  <script src="simulation/HeartTest.js"></script>
	<script src="simulation/HeartTest2.js"></script>

	<script id="shader-fs" type="x-shader/x-fragment">
			precision mediump float;

			varying vec2 vTextureCoord;
			varying vec3 vLightWeighting;

			uniform sampler2D uSampler;

			void main(void) {
					vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
					gl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);
			}
	</script>

	<script id="shader-vs" type="x-shader/x-vertex">
			attribute vec3 aVertexPosition;
			attribute vec3 aVertexNormal;
			attribute vec2 aTextureCoord;

			uniform mat4 uMVMatrix;
			uniform mat4 uPMatrix;
			uniform mat3 uNMatrix;

			uniform vec3 uAmbientColor;

			uniform vec3 uLightingDirection;
			uniform vec3 uDirectionalColor;

			uniform bool uUseLighting;

			varying vec2 vTextureCoord;
			varying vec3 vLightWeighting;

			void main(void) {
					gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
					vTextureCoord = aTextureCoord;

					if (!uUseLighting) {
							vLightWeighting = vec3(1.0, 1.0, 1.0);
					} else {
							vec3 transformedNormal = uNMatrix * aVertexNormal;
							float directionalLightWeighting = max(dot(transformedNormal, uLightingDirection), 0.0);
							vLightWeighting = uAmbientColor + uDirectionalColor * directionalLightWeighting;
					}
			}
	</script>

<script>
						var gl;
	console.log(gl);
	console.log('gl set fgor webgl');
						function initGL(canvas) {
								try {
										gl = canvas.getContext("experimental-webgl");
										gl.viewportWidth = canvas.width;
										gl.viewportHeight = canvas.height;
								} catch (e) {
								}
								if (!gl) {
										alert("Could not initialise WebGL, sorry :-(");
								}
						}


						function getShader(gl, id) {
								var shaderScript = document.getElementById(id);
								if (!shaderScript) {
										return null;
								}

								var str = "";
								var k = shaderScript.firstChild;
								while (k) {
										if (k.nodeType == 3) {
												str += k.textContent;
										}
										k = k.nextSibling;
								}

								var shader;
								if (shaderScript.type == "x-shader/x-fragment") {
										shader = gl.createShader(gl.FRAGMENT_SHADER);
								} else if (shaderScript.type == "x-shader/x-vertex") {
										shader = gl.createShader(gl.VERTEX_SHADER);
								} else {
										return null;
								}

								gl.shaderSource(shader, str);
								gl.compileShader(shader);

								if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
										alert(gl.getShaderInfoLog(shader));
										return null;
								}

								return shader;
						}


						var shaderProgram;

						function initShaders() {
								var fragmentShader = getShader(gl, "shader-fs");
								var vertexShader = getShader(gl, "shader-vs");

								shaderProgram = gl.createProgram();
								gl.attachShader(shaderProgram, vertexShader);
								gl.attachShader(shaderProgram, fragmentShader);
								gl.linkProgram(shaderProgram);

								if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
										alert("Could not initialise shaders");
								}

								gl.useProgram(shaderProgram);

								shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
								gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);

								shaderProgram.textureCoordAttribute = gl.getAttribLocation(shaderProgram, "aTextureCoord");
								gl.enableVertexAttribArray(shaderProgram.textureCoordAttribute);

								shaderProgram.vertexNormalAttribute = gl.getAttribLocation(shaderProgram, "aVertexNormal");
								gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute);

								shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, "uPMatrix");
								shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, "uMVMatrix");
								shaderProgram.nMatrixUniform = gl.getUniformLocation(shaderProgram, "uNMatrix");
								shaderProgram.samplerUniform = gl.getUniformLocation(shaderProgram, "uSampler");
								shaderProgram.useLightingUniform = gl.getUniformLocation(shaderProgram, "uUseLighting");
								shaderProgram.ambientColorUniform = gl.getUniformLocation(shaderProgram, "uAmbientColor");
								shaderProgram.lightingDirectionUniform = gl.getUniformLocation(shaderProgram, "uLightingDirection");
								shaderProgram.directionalColorUniform = gl.getUniformLocation(shaderProgram, "uDirectionalColor");
						}


						function handleLoadedTexture(texture) {
								gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
								gl.bindTexture(gl.TEXTURE_2D, texture);
								gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, texture.image);
								gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
								gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);
								gl.generateMipmap(gl.TEXTURE_2D);

								gl.bindTexture(gl.TEXTURE_2D, null);
						}


						var moonTexture;

						function initTexture() {
								moonTexture = gl.createTexture();
								moonTexture.image = new Image();
								moonTexture.image.onload = function () {
										handleLoadedTexture(moonTexture)
								}

								moonTexture.image.src = "heart.gif";
						}


						var mvMatrix = mat4.create();
						var mvMatrixStack = [];
						var pMatrix = mat4.create();

						function mvPushMatrix() {
								var copy = mat4.create();
								mat4.set(mvMatrix, copy);
								mvMatrixStack.push(copy);
						}

						function mvPopMatrix() {
								if (mvMatrixStack.length == 0) {
										throw "Invalid popMatrix!";
								}
								mvMatrix = mvMatrixStack.pop();
						}

						function setMatrixUniforms() {
								gl.uniformMatrix4fv(shaderProgram.pMatrixUniform, false, pMatrix);
								gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform, false, mvMatrix);

								var normalMatrix = mat3.create();
								mat4.toInverseMat3(mvMatrix, normalMatrix);
								mat3.transpose(normalMatrix);
								gl.uniformMatrix3fv(shaderProgram.nMatrixUniform, false, normalMatrix);
						}


						function degToRad(degrees) {
								return degrees * Math.PI / 180;
						}


						var mouseDown = false;
						var lastMouseX = null;
						var lastMouseY = null;

						var moonRotationMatrix = mat4.create();
						mat4.identity(moonRotationMatrix);

						function handleMouseDown(event) {
								mouseDown = true;
								lastMouseX = event.clientX;
								lastMouseY = event.clientY;
						}


						function handleMouseUp(event) {
								mouseDown = false;
						}


						function handleMouseMove(event) {
								if (!mouseDown) {
										return;
								}
								var newX = event.clientX;
								var newY = event.clientY;

								var deltaX = newX - lastMouseX
								var newRotationMatrix = mat4.create();
								mat4.identity(newRotationMatrix);
								mat4.rotate(newRotationMatrix, degToRad(deltaX / 10), [0, 1, 0]);

								var deltaY = newY - lastMouseY;
								mat4.rotate(newRotationMatrix, degToRad(deltaY / 10), [1, 0, 0]);

								mat4.multiply(newRotationMatrix, moonRotationMatrix, moonRotationMatrix);

								lastMouseX = newX
								lastMouseY = newY;
						}



						var moonVertexPositionBuffer;
						var moonVertexNormalBuffer;
						var moonVertexTextureCoordBuffer;
						var moonVertexIndexBuffer;

						function initBuffers() {
								var latitudeBands = 30;
								var longitudeBands = 30;
								var radius = 2;

								var vertexPositionData = [];
								var normalData = [];
								var textureCoordData = [];
								for (var latNumber=0; latNumber <= latitudeBands; latNumber++) {
										var theta = latNumber * Math.PI / latitudeBands;
										var sinTheta = Math.sin(theta);
										var cosTheta = Math.cos(theta);

										for (var longNumber=0; longNumber <= longitudeBands; longNumber++) {
												var phi = longNumber * 2 * Math.PI / longitudeBands;
												var sinPhi = Math.sin(phi);
												var cosPhi = Math.cos(phi);

												var x = cosPhi * sinTheta;
												var y = cosTheta;
												var z = sinPhi * sinTheta;
												var u = 1 - (longNumber / longitudeBands);
												var v = 1 - (latNumber / latitudeBands);

												normalData.push(x);
												normalData.push(y);
												normalData.push(z);
												textureCoordData.push(u);
												textureCoordData.push(v);
												vertexPositionData.push(radius * x);
												vertexPositionData.push(radius * y);
												vertexPositionData.push(radius * z);
										}
								}

								var indexData = [];
								for (var latNumber=0; latNumber < latitudeBands; latNumber++) {
										for (var longNumber=0; longNumber < longitudeBands; longNumber++) {
												var first = (latNumber * (longitudeBands + 1)) + longNumber;
												var second = first + longitudeBands + 1;
												indexData.push(first);
												indexData.push(second);
												indexData.push(first + 1);

												indexData.push(second);
												indexData.push(second + 1);
												indexData.push(first + 1);
										}
								}

								moonVertexNormalBuffer = gl.createBuffer();
								gl.bindBuffer(gl.ARRAY_BUFFER, moonVertexNormalBuffer);
								gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(normalData), gl.STATIC_DRAW);
								moonVertexNormalBuffer.itemSize = 3;
								moonVertexNormalBuffer.numItems = normalData.length / 3;

								moonVertexTextureCoordBuffer = gl.createBuffer();
								gl.bindBuffer(gl.ARRAY_BUFFER, moonVertexTextureCoordBuffer);
								gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordData), gl.STATIC_DRAW);
								moonVertexTextureCoordBuffer.itemSize = 2;
								moonVertexTextureCoordBuffer.numItems = textureCoordData.length / 2;

								moonVertexPositionBuffer = gl.createBuffer();
								gl.bindBuffer(gl.ARRAY_BUFFER, moonVertexPositionBuffer);
								gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertexPositionData), gl.STATIC_DRAW);
								moonVertexPositionBuffer.itemSize = 3;
								moonVertexPositionBuffer.numItems = vertexPositionData.length / 3;

								moonVertexIndexBuffer = gl.createBuffer();
								gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, moonVertexIndexBuffer);
								gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indexData), gl.STATIC_DRAW);
								moonVertexIndexBuffer.itemSize = 1;
								moonVertexIndexBuffer.numItems = indexData.length;
						}


						function drawScene() {
								gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
								gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

								mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0, pMatrix);

								var lighting = document.getElementById("lighting").checked;
								gl.uniform1i(shaderProgram.useLightingUniform, lighting);
								if (lighting) {
										gl.uniform3f(
												shaderProgram.ambientColorUniform,
												parseFloat(document.getElementById("ambientR").value),
												parseFloat(document.getElementById("ambientG").value),
												parseFloat(document.getElementById("ambientB").value)
										);

										var lightingDirection = [
												parseFloat(document.getElementById("lightDirectionX").value),
												parseFloat(document.getElementById("lightDirectionY").value),
												parseFloat(document.getElementById("lightDirectionZ").value)
										];
										var adjustedLD = vec3.create();
										vec3.normalize(lightingDirection, adjustedLD);
										vec3.scale(adjustedLD, -1);
										gl.uniform3fv(shaderProgram.lightingDirectionUniform, adjustedLD);

										gl.uniform3f(
												shaderProgram.directionalColorUniform,
												parseFloat(document.getElementById("directionalR").value),
												parseFloat(document.getElementById("directionalG").value),
												parseFloat(document.getElementById("directionalB").value)
										);
								}

								mat4.identity(mvMatrix);

								mat4.translate(mvMatrix, [0, 0, -6]);

								mat4.multiply(mvMatrix, moonRotationMatrix);

								gl.activeTexture(gl.TEXTURE0);
								gl.bindTexture(gl.TEXTURE_2D, moonTexture);
								gl.uniform1i(shaderProgram.samplerUniform, 0);

								gl.bindBuffer(gl.ARRAY_BUFFER, moonVertexPositionBuffer);
								gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, moonVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);

								gl.bindBuffer(gl.ARRAY_BUFFER, moonVertexTextureCoordBuffer);
								gl.vertexAttribPointer(shaderProgram.textureCoordAttribute, moonVertexTextureCoordBuffer.itemSize, gl.FLOAT, false, 0, 0);

								gl.bindBuffer(gl.ARRAY_BUFFER, moonVertexNormalBuffer);
								gl.vertexAttribPointer(shaderProgram.vertexNormalAttribute, moonVertexNormalBuffer.itemSize, gl.FLOAT, false, 0, 0);

								gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, moonVertexIndexBuffer);
								setMatrixUniforms();
								gl.drawElements(gl.TRIANGLES, moonVertexIndexBuffer.numItems, gl.UNSIGNED_SHORT, 0);
						}


						function tick() {
								requestAnimFrame(tick);
								drawScene();
						}


						function webGLStart() {
	console.log('webgl start');
								var canvas = document.getElementById("lesson11-canvas");
								initGL(canvas);
								initShaders();
								initBuffers();
								initTexture();

								gl.clearColor(0.0, 0.0, 0.0, 0.0);
								gl.enable(gl.DEPTH_TEST);

								canvas.onmousedown = handleMouseDown;
								document.onmouseup = handleMouseUp;
								document.onmousemove = handleMouseMove;

								tick();
						}
</script>
</body>
</html>
